<p-toast key="hht"></p-toast>
<p-panel [header]="'HORA HOMBRES TRABAJADAS'">
    <p-accordion [multiple]="true">
        <div class="p-fluid p-grid p-formgrid">
            <div class="ui-g-3 ui-md-3 ui-sm-12">
                <label for="">Seleccionar año:</label>
                <p-dropdown appendTo="body" [options]="yearRange" placeholder="Seleccionar año" (onChange)="onSelectAnio($event)"></p-dropdown>
            </div>
            <div class="ui-g-3 ui-sm-12 ui-md-3">
                <label for="">Seleccionar empresa:</label>
                <p-dropdown appendTo="body" [options]="Empresas" placeholder="Seleccionar empresa" (onChange)="onSelectEmpresa($event)"></p-dropdown>
            </div>
        </div><br><hr><br>
        <ng-container> <!--  *ngIf="mostrarForm" -->
            <div class="ui-g">
                <div class="ui-g-3 ui-sm-12 iu-md-3">
                    <label for="" style="margin-right: 10px;">Mes a editar:</label>
                    <p-dropdown [options]="meses"
                    [(ngModel)]="selectedMes"
                    placeholder="--Seleccione--"
                    [showClear]="true"></p-dropdown>
                </div>
                <!-- <div class="ui-g-6 ui-sm-12 ui-md-2" >
                    Meta Mensual ILI:
                </div>
                <div class="ui-g-6 ui-sm-12 ui-md-2">
                    <input pInputText [(ngModel)]="metaMensualILI" placeholder="0" type="number"/>
                </div> -->
            </div>
            <div class="ui-g" style="margin-top: 20px;">
                <div class="ui-g-3 ui-sm-12 ui-md-3" *ngIf="anioSelected && empresaSelected && empresaSelected=='22'">
                    <label for="" style="margin-right: 10px;">Meta total para {{findEmpresaById(empresaSelected)}}:</label>
                    <input pInputText [(ngModel)]="metaAnualILI" placeholder="0" type="number"/>
                </div>
            </div>
            <ng-container *ngFor="let mes of meses; let i = index;">
                <p-accordionTab *ngIf="mes.value === selectedMes" header={{mes.label}} [selected]="true" [disabled]="true">
                    <div class="ui-g">
                        <div class="ui-g-6 ui-sm-6 ui-md-2">
                            Total mes No. PERSONAS:
                        </div>
                        <div class="ui-g-6 ui-sm-6 ui-md-2">
                            <input pInputText readonly 
                            *ngIf="dataHHT.length > 0"
                            [(ngModel)]="dataHHT[i].NumPersonasMes" 
                            placeholder="0" type="number"/>
                        </div>
                        <div class="ui-g-6 ui-sm-6 ui-md-2" >
                            Total mes HHT:
                        </div>
                        <div class="ui-g-6 ui-sm-6 ui-md-2">
                            <input pInputText readonly
                            *ngIf="dataHHT.length > 0" 
                            [(ngModel)]="dataHHT[i].HhtMes" 
                            placeholder="0" type="number"/>
                        </div>
                    </div>
                    
                    <div *ngIf="areaList">
                        <ng-container *ngFor="let area of areaList; let j = index;">
                            <p-accordionTab header={{area.nombre}} >

                                <div class="ui-g">
                                    <div class="ui-g-2 ui-sm-12 ui-md-2">
                                        Total area No. PERSONAS:
                                    </div>
                                    <div class="ui-g-2 ui-sm-12 ui-md-2">
                                        <input pInputText [readonly]="tienePlantas(area.id)" 
                                        placeholder="0"
                                        (keyup)="calcularTotalesMes(i)"
                                        *ngIf="dataHHT[i]"
                                        [(ngModel)]="dataHHT[i].Areas[j].NumPersonasArea" 
                                        type="number"/>
                                    </div>
                                    <div class="ui-g-2 ui-sm-12 ui-md-2" >
                                        Total area HHT:
                                    </div>
                                    <div class="ui-g-2 ui-sm-12 ui-md-2">
                                        <input pInputText [readonly]="tienePlantas(area.id)" 
                                        placeholder="0"
                                        (keyup)="calcularTotalesMes(i)"
                                        *ngIf="dataHHT[i]"
                                        [(ngModel)]="dataHHT[i].Areas[j].HhtArea" 
                                        type="number"/>
                                    </div>
                                    <ng-container *ngIf="empresaSelected==22">
                                        <div class="ui-g-2 ui-sm-12 ui-md-2" >
                                            Meta {{area.nombre}}:
                                        </div>
                                        <div class="ui-g-2 ui-sm-12 ui-md-2">
                                            <input pInputText placeholder="0"
                                            *ngIf="dataHHT[i]"
                                            (keyup)="setMetaPorArea(j, dataHHT[i].Areas[j].ILIArea)"
                                            [(ngModel)]="dataHHT[i].Areas[j].ILIArea" 
                                            type="number"/>
                                        </div>
                                    </ng-container>
                                </div>

                                <div *ngIf="plantasList">
                                <!-- <div> -->
                                    <ng-container *ngFor="let pl of getPlantasByArea(area.id); let k = index;"><!-- {{test([i,j,k])}} -->
                                    <!-- <ng-container *ngFor="let pl of plantasList; let k = index;"> -->
                                        <p-accordionTab header={{pl.nombre}}>
                                            <div class="ui-g">
                                                <div class="ui-g-6 ui-sm-12 ui-md-2">
                                                    No. PERSONAS:
                                                </div>
                                                <div class="ui-g-6 ui-sm-12 ui-md-2">
                                                    <input pInputText placeholder="0"
                                                    *ngIf="dataHHT[i]"
                                                    [(ngModel)]="dataHHT[i].Areas[j].Plantas[k].NumPersonasPlanta" 
                                                    (keyup)="calcularTotalesPorArea(i, j)" 
                                                    type="number"/>
                                                </div>
                                                <div class="ui-g-6 ui-sm-12 ui-md-2" >
                                                    HHT:
                                                </div>
                                                <div class="ui-g-6 ui-sm-12 ui-md-2" #acordionTab>
                                                    <input pInputText placeholder="0"
                                                    *ngIf="dataHHT[i]"
                                                    [(ngModel)]="dataHHT[i].Areas[j].Plantas[k].HhtPlanta" 
                                                    (keyup)="calcularTotalesPorArea(i, j)" 
                                                    type="number"/>
                                                </div>
                                            </div>
                                        </p-accordionTab>
                                    </ng-container>
                                </div>
                            </p-accordionTab>
                        </ng-container>
                    </div>
                </p-accordionTab>
            </ng-container>
        </ng-container>
    </p-accordion>
</p-panel>

<ng-container *ngIf="anioSelected && empresaSelected && esNuevoRegistro && mostrarBotones">
    <button pButton type="button" icon="fa fa-floppy-o" title="Guardar"
        (click)="guardarHht()" class="float-btn"></button>
        <!-- guardarHht() -->
</ng-container>

<ng-container *ngIf="anioSelected && empresaSelected && !esNuevoRegistro && mostrarBotones">
    <button  pButton type="button" icon="fa fa-pencil" title="Modificar"
        (click)="actualizarHht()" class="ui-button-success float-btn" style="z-index: 100;"></button>
</ng-container>

