<p-growl [value]="msgs"></p-growl>
<p-panel styleClass="material-panel">
    <p-header>
        Casos médicos
    </p-header>

    <p-table #dt styleClass="material-table" autoLayout="true" selectionMode="single" [loading]="loading" [(selection)]="caseSelect" [value]="(idEmpresa=='22')?casosList2:casosList" [paginator]="true" [rows]="12" dataKey="id" [lazy]="true" (onLazyLoad)="lazyLoad($event)" sortField="fechaCreacion" sortOrder="1"
        [totalRecords]="totalRecords">
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th pSortableColumn="id">#CASO
                    <p-sortIcon field="id"></p-sortIcon>
                </th>
                <th pSortableColumn="fechaCreacion">Fecha de apertura
                    <p-sortIcon field="fechaCreacion"></p-sortIcon>
                </th>
                <th pSortableColumn="region" *ngIf="idEmpresa!='22'">Regional
                    <p-sortIcon field="region"></p-sortIcon>
                </th>
                <th pSortableColumn="nombrePadre" *ngIf="idEmpresa=='22'">División/Unidad
                    <p-sortIcon field="nombrePadre"></p-sortIcon>
                </th>
                <th pSortableColumn="ciudad" *ngIf="idEmpresa!='22'">Ciudad
                    <p-sortIcon field="ciudad"></p-sortIcon>
                </th>
                <th pSortableColumn="region" *ngIf="idEmpresa=='22'">Ubicación
                    <p-sortIcon field="region"></p-sortIcon>
                </th>
                <th pSortableColumn="pkUser">Apellido
                    <p-sortIcon field="pkUser"></p-sortIcon>
                </th>
                <th pSortableColumn="pkUser">Nombre
                    <p-sortIcon field="pkUser"></p-sortIcon>
                </th>
                <th pSortableColumn="documento">Documento
                    <p-sortIcon field="documento"></p-sortIcon>
                </th>
                <th pSortableColumn="statusCaso">Estado de caso
                    <p-sortIcon field="statusCaso"></p-sortIcon>
                </th>
                <th pSortableColumn="casoMedicoLaboral">Caso de mesa laboral
                    <p-sortIcon field="casoMedicoLaboral"></p-sortIcon>
                </th>
                <th pSortableColumn="prioridadCaso">Prioridad
                    <p-sortIcon field="prioridadCaso"></p-sortIcon>
                </th>
                <th pSortableColumn="tipoCaso">Tipo de caso
                    <p-sortIcon field="tipoCaso"></p-sortIcon>
                </th>
                <th pSortableColumn="tipoReporte" *ngIf="idEmpresa=='22'">Tipo de retorno
                    <!-- <p-sortIcon field="tipoReporte"></p-sortIcon> -->
                </th>
            </tr>
            <tr class="filters">
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="number" (input)="dt.filter($event.target.value, 'id', 'equals')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                                                
                        <s-rangoFechaSelector (onSelect)="dt.filter($event, 'fechaCreacion', 'bt')">
                        </s-rangoFechaSelector>                      

                    </div>
                </td>
                <td *ngIf="idEmpresa!='22'">
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'region', 'contains')">
                    </div>
                </td>
                <td *ngIf="idEmpresa=='22'">
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value,'pkUser.area.padreNombre')">
                    </div>
                </td>
                <td *ngIf="idEmpresa!='22'">
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value,'ciudad', 'contains')">
                    </div>
                </td>
                <td *ngIf="idEmpresa=='22'">
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value,'region', 'contains')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <!-- <input pInputText type="text" (input)="dt.filter($event.target.value, 'primerApellido')"> -->
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'pkUser.primerApellido')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <!-- <input pInputText type="text" (input)="dt.filter($event.target.value, 'primerNombre')"> -->
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'pkUser.primerNombre')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'documento', 'contains')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter(DecodificacionEstado($event.target.value), 'statusCaso', 'contains')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <!-- <input pInputText type="text" (input)="dt.filter( $event.target.value=='Si'?'1':'0', 'casoMedicoLaboral', 'contains')"> -->
                        <input pInputText type="text" (input)="dt.filter(DecodificacionSiNo($event.target.value), 'casoMedicoLaboral', 'contains')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'prioridadCaso','contains')">
                    </div>
                </td>
                <td>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'tipoCaso','contains')">
                    </div>
                </td>
                <td *ngIf="idEmpresa=='22'">
                    <div class="ui-inputgroup">
                        <!-- <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span> -->
                        <!-- <input pInputText type="text" (input)="dt.filter($event.target.value, 'tipoReporte')"> -->
                    </div>
                </td>
                <!-- <td *ngIf="idEmpresa=='22'">
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon">
                            <em class="pi pi-search"></em>
                        </span>
                        <input pInputText type="text" (input)="dt.filter($event.target.value, 'tipoReporte')">
                    </div>
                </td> -->
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-case>

            <tr [pSelectableRow]="case" class="table-row table-row-selectable">
                <td class="p-text-center">{{case.id}}</td>
                <td class="p-text-center">{{case.fechaCreacion | date: 'dd/MM/yyyy'}}</td>
                <td class="p-text-center" *ngIf="idEmpresa!='22'">{{case.region}}</td>
                <td class="p-text-center" *ngIf="idEmpresa=='22'">{{case.nombrePadre}}</td>
                <td class="p-text-center" *ngIf="idEmpresa!='22'">{{case.ciudad}}</td>
                <td class="p-text-center" *ngIf="idEmpresa=='22'">{{case.region}}</td>
                <td class="p-text-center">{{case.primerApellido}}</td>
                <td class="p-text-center">{{case.primerNombre}} </td>
                <td class="p-text-center">{{case.documento}}</td>
                <td class="p-text-center">{{case.statusCaso == 1 ? 'Abierto' : 'Cerrado'}}</td>
                <td class="p-text-center">{{case.casoMedicoLaboral == 1 ? 'Si' :case.casoMedicoLaboral == 2 ? 'En seguimiento':case.casoMedicoLaboral == 3 ?'No aplica':case.casoMedicoLaboral == 0 ?'No':''}}</td>
                <!-- <td class="p-text-center">{{case.casoMedicoLaboral == 1 ? 'Si' : 'No'}}</td> -->                
                <td class="p-text-center status" [ngClass]="{
                    'status--danger': case.prioridadCaso === 'Alta' , 
                    'status--success': case.prioridadCaso === 'Baja',
                    'status--info': case.prioridadCaso === 'Media'
                }">{{case.prioridadCaso}}</td>
                <td class="p-text-center">{{case.tipoCaso}}</td>
                <td class="p-text-center" *ngIf="idEmpresa=='22'">{{case.tipoReporte}}</td>

            </tr>
        </ng-template>
        <ng-template pTemplate="summary" let-rowData>
            <button *sTienePermiso="'SCM_CREATE_CASE'" pButton type="button" icon="fa fa-plus" [routerLink]="['/app/scm/creacion']" label="Crear"></button>

            <button *sTienePermiso="'SCM_PUT_CASE'" pButton type="button" icon="fa fa-pencil" label="Modificar" class="ui-button-success" (click)="openCase()" [disabled]="!caseSelect"></button>

            <button *sTienePermiso="'SCM_LIST_CASE'" pButton type="button" icon="fa fa-search" label="Consultar" class="ui-button-warning" (click)="openCaseConsultar()" [disabled]="!caseSelect"></button>
            <!--  <button *sTienePermiso="'ADM_DELETE_USR'" pButton type="button" icon="fa fa-trash" label="Eliminar" class="ui-button-danger"
            (click)="eliminar()" [disabled]="!usuarioSelect"></button>-->
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="9" class="p-text-center">No hay registro de casos médicos o con los términos de filtro usados
                </td>
            </tr>
        </ng-template>
    </p-table>


</p-panel>
<!-- <button (click)="test2()">test</button> -->

<!-- <div>
    <app-formulario-scm *ngIf="visibleForm && caseSelect" (onCancel)="onCancel()" [consultar]="consultar" [caseSelect]="caseSelect">
    </app-formulario-scm>
</div> -->